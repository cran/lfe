
R Under development (unstable) (2014-10-08 r66730) -- "Unsuffered Consequences"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
> set.seed(65513)
> options(lfe.threads=1,digits=4,warn=1)
> x <- rnorm(52)
> x2 <- rnorm(length(x))
> x3 <- 0.2*x + 0.1*x2
> ## create individual and firm
> id <- factor(sample(30,length(x),prob=c(2,2,rep(1,28)),replace=TRUE))
> firm <- factor(sample(32,length(x),prob=c(2,2,rep(1,30)),replace=TRUE))
> year <- factor(sample(3,length(x),replace=TRUE))
> ## effects
> id.eff <- rnorm(nlevels(id))
> firm.eff <- rnorm(nlevels(firm))
> year.eff <- rnorm(nlevels(year))
> ## left hand side
> y <- x + 0.25*x2 + x3 + id.eff[id] + firm.eff[firm] + year.eff[year] + rnorm(length(x))
> 
> ## estimate and print result
> summary(est <- felm(y ~ x+x2+x3 |id+firm+year, exactDOF=TRUE))
Warning in chol.default(mat, pivot = TRUE, tol = tol) :
  the matrix is either rank-deficient or indefinite

Call:
   felm(formula = y ~ x + x2 + x3 | id + firm + year, exactDOF = TRUE) 

Residuals:
      Min        1Q    Median        3Q       Max 
-1.38e+00 -9.22e-09  0.00e+00  1.55e-08  1.38e+00 

Coefficients:
   Estimate Std. Error t value Pr(>|t|)  
x     1.174      0.473    2.48    0.068 .
x2    0.344      0.521    0.66    0.545  
x3       NA         NA      NA       NA  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.4 on 4 degrees of freedom
Multiple R-squared: 0.953   Adjusted R-squared: 0.385 
F-statistic:1.71 on 47 and 4 DF, p-value: 0.324 


> 
> ## extract the group fixed effects
> getfe(est)
          effect obs comp   fe idx
id.1     2.70645   2    1   id   1
id.2     0.00000   5    1   id   2
id.3     0.00000   1    4   id   3
id.5    -0.92442   2    1   id   5
id.6     2.61776   3    1   id   6
id.7     1.15197   2    1   id   7
id.10    2.19930   1    1   id  10
id.11    1.73017   1    1   id  11
id.12    0.33843   1    1   id  12
id.13   -1.27133   1    3   id  13
id.14    0.11573   1    2   id  14
id.15    0.81774   2    1   id  15
id.16    0.23114   1    1   id  16
id.17    1.88311   1    1   id  17
id.19    1.07002   3    1   id  19
id.21    0.38365   5    1   id  21
id.22   -1.28847   2    1   id  22
id.24    0.56730   4    1   id  24
id.27    6.42877   2    1   id  27
id.28    1.16319   2    1   id  28
id.29    0.00000   4    3   id  29
id.30    0.00000   6    2   id  30
firm.1  -0.74845   1    2 firm   1
firm.2  -9.69646   1    1 firm   2
firm.3  -3.87980   1    2 firm   3
firm.4  -3.74456   1    1 firm   4
firm.7   0.01346   3    1 firm   7
firm.8  -3.03499   5    1 firm   8
firm.9  -2.64392   2    3 firm   9
firm.11 -2.77900   3    1 firm  11
firm.12 -2.10260   1    2 firm  12
firm.13 -2.32073   3    1 firm  13
firm.14 -2.50130   1    3 firm  14
firm.15 -3.59719   3    1 firm  15
firm.16 -3.60586   3    1 firm  16
firm.17 -3.37404   4    1 firm  17
firm.18 -1.24033   3    1 firm  18
firm.19 -1.53253   2    1 firm  19
firm.20 -1.70536   1    1 firm  20
firm.22 -3.10402   2    2 firm  22
firm.23  2.57920   1    4 firm  23
firm.24 -4.19059   1    2 firm  24
firm.25 -3.01265   1    2 firm  25
firm.26 -1.68302   2    1 firm  26
firm.27 -1.37604   2    3 firm  27
firm.29 -4.45157   2    1 firm  29
firm.31 -5.99094   1    1 firm  31
firm.32 -6.61894   2    1 firm  32
year.1   0.00000  21    5 year   1
year.2   1.48017  18    5 year   2
year.3   2.77437  13    5 year   3
> print(alpha <- getfe(est,ef='ln'))
Warning in is.estimable(ef, obj$fe) :
  non-estimable function, largest error 0.4 in coordinate 3 ("id.3")
Warning in getfe.kaczmarz(obj, se, ef = ef, bN = bN, robust = robust, cluster = cluster) :
  Supplied function seems non-estimable
          effect obs comp   fe idx
id.1     1.35733   2    1   id   1
id.2    -1.34912   5    1   id   2
id.3     2.28701   1    4   id   3
id.5    -2.27354   2    1   id   5
id.6     1.26864   3    1   id   6
id.7    -0.19715   2    1   id   7
id.10    0.85018   1    1   id  10
id.11    0.38105   1    1   id  11
id.12   -1.01069   1    1   id  12
id.13   -1.12442   1    3   id  13
id.14   -0.53238   1    2   id  14
id.15   -0.53138   2    1   id  15
id.16   -1.11798   1    1   id  16
id.17    0.53399   1    1   id  17
id.19   -0.27910   3    1   id  19
id.21   -0.96547   5    1   id  21
id.22   -2.63759   2    1   id  22
id.24   -0.78182   4    1   id  24
id.27    5.07965   2    1   id  27
id.28   -0.18593   2    1   id  28
id.29    0.14691   4    3   id  29
id.30   -0.64811   6    2   id  30
firm.1   1.89449   1    2 firm   1
firm.2  -6.35251   1    1 firm   2
firm.3  -1.23686   1    2 firm   3
firm.4  -0.40061   1    1 firm   4
firm.7   3.35740   3    1 firm   7
firm.8   0.30895   5    1 firm   8
firm.9  -0.79601   2    3 firm   9
firm.11  0.56495   3    1 firm  11
firm.12  0.54034   1    2 firm  12
firm.13  1.02322   3    1 firm  13
firm.14 -0.65339   1    3 firm  14
firm.15 -0.25325   3    1 firm  15
firm.16 -0.26191   3    1 firm  16
firm.17 -0.03009   4    1 firm  17
firm.18  2.10362   3    1 firm  18
firm.19  1.81141   2    1 firm  19
firm.20  1.63858   1    1 firm  20
firm.22 -0.46109   2    2 firm  22
firm.23  2.28701   1    4 firm  23
firm.24 -1.54766   1    2 firm  24
firm.25 -0.36971   1    2 firm  25
firm.26  1.66093   2    1 firm  26
firm.27  0.47188   2    3 firm  27
firm.29 -1.10763   2    1 firm  29
firm.31 -2.64699   1    1 firm  31
firm.32 -3.27499   2    1 firm  32
year.1  -1.99482  21    5 year   1
year.2  -0.51465  18    5 year   2
year.3   0.77954  13    5 year   3
> # get the names to use below, just to make it easier
> # lower precision in output
> 
> nm <- rownames(alpha)
> getfe(est,ef='zm',se=TRUE)
          effect obs comp     se
id.1     2.70645   2    1 2.9403
id.2     0.00000   5    1 0.0000
id.5    -0.92442   2    1 3.3406
id.6     2.61776   3    1 4.1052
id.7     1.15197   2    1 1.9617
id.10    2.19930   1    1 4.4684
id.11    1.73017   1    1 3.7649
id.12    0.33843   1    1 2.3717
id.15    0.81774   2    1 2.5398
id.16    0.23114   1    1 3.9796
id.17    1.88311   1    1 4.2110
id.19    1.07002   3    1 2.3660
id.21    0.38365   5    1 1.3127
id.22   -1.28847   2    1 1.4788
id.24    0.56730   4    1 1.2635
id.27    6.42877   2    1 3.8400
id.28    1.16319   2    1 3.1657
firm.2  -6.23633   1    1 3.3551
firm.4  -0.28443   1    1 3.2411
firm.7   3.47359   3    1 1.6619
firm.8   0.42514   5    1 2.8788
firm.11  0.68113   3    1 1.3020
firm.13  1.13940   3    1 1.6724
firm.15 -0.13707   3    1 2.8821
firm.16 -0.14573   3    1 1.7931
firm.17  0.08609   4    1 1.4324
firm.18  2.21980   3    1 1.4763
firm.19  1.92760   2    1 1.5758
firm.20  1.75477   1    1 2.5547
firm.26  1.77711   2    1 1.5621
firm.29 -0.99145   2    1 1.6179
firm.31 -2.53081   1    1 2.5565
firm.32 -3.15881   2    1 2.1548
icpt.1  -3.46013  39    1 2.0316
id.14    0.11573   1    2 2.2950
id.30    0.00000   6    2 0.0000
firm.1   2.09124   1    2 1.3284
firm.3  -1.04011   1    2 1.3853
firm.12  0.73709   1    2 1.5060
firm.22 -0.26434   2    2 1.3925
firm.24 -1.35091   1    2 1.3090
firm.25 -0.17296   1    2 1.5450
icpt.2  -2.83969   7    2 1.1429
id.13   -1.27133   1    3 2.2687
id.29    0.00000   4    3 0.0000
firm.9  -0.47017   2    3 1.1368
firm.14 -0.32755   1    3 1.1987
firm.27  0.79772   2    3 1.1482
icpt.3  -2.17375   5    3 0.9079
id.3     0.00000   1    4 0.0000
firm.23  0.00000   1    4 0.0000
icpt.4   2.57920   1    4 1.2253
year.1   0.00000  21    5 0.0000
year.2   1.48017  18    5 1.1042
year.3   2.77437  13    5 1.2127
> getfe(est,ef='zm2',se=TRUE)
          effect obs comp     se
id.1     1.46667   2    1 2.1720
id.2    -1.23977   5    1 1.7389
id.5    -2.16419   2    1 1.8755
id.6     1.37799   3    1 2.4533
id.7    -0.08780   2    1 1.7748
id.10    0.95953   1    1 2.9711
id.11    0.49040   1    1 2.6489
id.12   -0.90134   1    1 2.5070
id.15   -0.42203   2    1 2.6964
id.16   -1.00863   1    1 2.8231
id.17    0.64334   1    1 2.5755
id.19   -0.16975   3    1 1.3969
id.21   -0.85612   5    1 1.2358
id.22   -2.52824   2    1 2.2548
id.24   -0.67247   4    1 1.4876
id.27    5.18900   2    1 2.6034
id.28   -0.07658   2    1 1.4970
firm.2  -6.23633   1    1 3.1132
firm.4  -0.28443   1    1 2.8899
firm.7   3.47359   3    1 1.6524
firm.8   0.42514   5    1 2.4695
firm.11  0.68113   3    1 1.3285
firm.13  1.13940   3    1 1.3255
firm.15 -0.13707   3    1 2.6962
firm.16 -0.14573   3    1 1.6387
firm.17  0.08609   4    1 1.3069
firm.18  2.21980   3    1 1.5147
firm.19  1.92760   2    1 1.7093
firm.20  1.75477   1    1 2.4941
firm.26  1.77711   2    1 1.6044
firm.29 -0.99145   2    1 1.6775
firm.31 -2.53081   1    1 2.8211
firm.32 -3.15881   2    1 1.8781
icpt.1  -2.22036  39    1 0.6706
id.14    0.05787   1    2 1.2071
id.30   -0.05787   6    2 1.2071
firm.1   2.09124   1    2 1.5290
firm.3  -1.04011   1    2 1.4185
firm.12  0.73709   1    2 1.4892
firm.22 -0.26434   2    2 1.3895
firm.24 -1.35091   1    2 1.2117
firm.25 -0.17296   1    2 1.2335
icpt.2  -2.78182   7    2 1.0349
id.13   -0.63567   1    3 1.0576
id.29    0.63567   4    3 1.0576
firm.9  -0.47017   2    3 1.0930
firm.14 -0.32755   1    3 1.0666
firm.27  0.79772   2    3 0.9703
icpt.3  -2.80942   5    3 1.5433
id.3     0.00000   1    4 0.0000
firm.23  0.00000   1    4 0.0000
icpt.4   2.57920   1    4 1.3354
year.1   0.00000  21    5 0.0000
year.2   1.48017  18    5 1.0697
year.3   2.77437  13    5 1.2440
> ef <- function(v,addnames) {
+   names(v) <- nm
+   w <- c(v['id.2']-v['id.1'],exp(v['id.2']-v['id.1']),
+          v['id.2']+v['firm.2']+v['year.1'],v['id.5']+v['firm.4']+v['year.2'])
+   if(addnames) names(w) <-c('id2-id1','exp(id2-id1)','id2+f2+y1','id5+f4+y2')
+   w
+ }
> getfe(est,ef=ef,se=TRUE)
               effect       se
id2-id1      -2.70645 2.714108
exp(id2-id1)  0.06677 0.007622
id2+f2+y1    -9.69646 4.307609
id5+f4+y2    -3.18881 3.445842
> 
> # test whether we have estimable functions
> 
> R <- est$r.residuals - est$residuals
> 
> cat('myef :',is.estimable(ef,est$fe,R),'\n')
myef : TRUE 
> for(n in c('ref','zm','zm2','ln')) {
+   cat(n,':',is.estimable(efactory(est,n),est$fe,R),'\n')
+ }
ref : TRUE 
zm : TRUE 
zm2 : TRUE 
Warning in is.estimable(efactory(est, n), est$fe, R) :
  non-estimable function, largest error 0.2 in coordinate 3 ("id.3")
ln : FALSE 
> 
> proc.time()
   user  system elapsed 
  5.133   0.116   5.008 
