
R Under development (unstable) (2013-12-03 r64376) -- "Unsuffered Consequences"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
> set.seed(65513)
> options(lfe.threads=1)
> x <- rnorm(52)
> x2 <- rnorm(length(x))
> x3 <- 0.2*x + 0.1*x2
> ## create individual and firm
> id <- factor(sample(30,length(x),prob=c(2,2,rep(1,28)),replace=TRUE))
> firm <- factor(sample(32,length(x),prob=c(2,2,rep(1,30)),replace=TRUE))
> year <- factor(sample(3,length(x),replace=TRUE))
> ## effects
> id.eff <- rnorm(nlevels(id))
> firm.eff <- rnorm(nlevels(firm))
> year.eff <- rnorm(nlevels(year))
> ## left hand side
> y <- x + 0.25*x2 + x3 + id.eff[id] + firm.eff[firm] + year.eff[year] + rnorm(length(x))
> 
> ## estimate and print result
> summary(est <- felm(y ~ x+x2+x3+G(id)+G(firm)+G(year), exactDOF=TRUE))

Call:
   felm(formula = y ~ x + x2 + x3 + G(id) + G(firm) + G(year), exactDOF = TRUE) 

Residuals:
       Min         1Q     Median         3Q        Max 
-1.383e+00 -3.794e-09  1.437e-10  8.380e-09  1.383e+00 

Coefficients:
   Estimate Std. Error t value Pr(>|t|)  
x    1.1740     0.4735    2.48   0.0682 .
x2   0.3439     0.5212    0.66   0.5454  
x3       NA         NA      NA       NA  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.403 on 4 degrees of freedom
Multiple R-squared: 0.9527   Adjusted R-squared: 0.3852 
F-statistic: 1.715 on 47 and 4 DF, p-value: 0.3237 


Warning message:
In chol.default(mat, pivot = TRUE) :
  the matrix is either rank-deficient or indefinite
> 
> ## extract the group fixed effects
> getfe(est)
             effect obs comp   fe idx
id.1     2.70644618   2    1   id   1
id.2     0.00000000   5    1   id   2
id.3     0.00000000   1    4   id   3
id.5    -0.92441898   2    1   id   5
id.6     2.61776176   3    1   id   6
id.7     1.15197399   2    1   id   7
id.10    2.19929956   1    1   id  10
id.11    1.73016949   1    1   id  11
id.12    0.33843230   1    1   id  12
id.13   -1.27133346   1    3   id  13
id.14    0.11573326   1    2   id  14
id.15    0.81774132   2    1   id  15
id.16    0.23113971   1    1   id  16
id.17    1.88311262   1    1   id  17
id.19    1.07001655   3    1   id  19
id.21    0.38365273   5    1   id  21
id.22   -1.28847025   2    1   id  22
id.24    0.56729771   4    1   id  24
id.27    6.42877236   2    1   id  27
id.28    1.16318705   2    1   id  28
id.29    0.00000000   4    3   id  29
id.30    0.00000000   6    2   id  30
firm.1  -0.74845001   1    2 firm   1
firm.2  -9.69645734   1    1 firm   2
firm.3  -3.87980014   1    2 firm   3
firm.4  -3.74455646   1    1 firm   4
firm.7   0.01345789   3    1 firm   7
firm.8  -3.03499085   5    1 firm   8
firm.9  -2.64392432   2    3 firm   9
firm.11 -2.77899898   3    1 firm  11
firm.12 -2.10259894   1    2 firm  12
firm.13 -2.32072766   3    1 firm  13
firm.14 -2.50130132   1    3 firm  14
firm.15 -3.59719488   3    1 firm  15
firm.16 -3.60585952   3    1 firm  16
firm.17 -3.37403813   4    1 firm  17
firm.18 -1.24032779   3    1 firm  18
firm.19 -1.53253166   2    1 firm  19
firm.20 -1.70536061   1    1 firm  20
firm.22 -3.10402368   2    2 firm  22
firm.23  2.57920077   1    4 firm  23
firm.24 -4.19059403   1    2 firm  24
firm.25 -3.01264720   1    2 firm  25
firm.26 -1.68301917   2    1 firm  26
firm.27 -1.37603551   2    3 firm  27
firm.29 -4.45157381   2    1 firm  29
firm.31 -5.99093615   1    1 firm  31
firm.32 -6.61893661   2    1 firm  32
year.1   0.00000000  21    5 year   1
year.2   1.48016942  18    5 year   2
year.3   2.77436872  13    5 year   3
> print(alpha <- getfe(est,ef='ln'))
            effect obs comp   fe idx
id.1     1.3573255   2    1   id   1
id.2    -1.3491207   5    1   id   2
id.3     2.2870124   1    4   id   3
id.5    -2.2735397   2    1   id   5
id.6     1.2686411   3    1   id   6
id.7    -0.1971467   2    1   id   7
id.10    0.8501789   1    1   id  10
id.11    0.3810488   1    1   id  11
id.12   -1.0106884   1    1   id  12
id.13   -1.1244246   1    3   id  13
id.14   -0.5323797   1    2   id  14
id.15   -0.5313794   2    1   id  15
id.16   -1.1179810   1    1   id  16
id.17    0.5339919   1    1   id  17
id.19   -0.2791041   3    1   id  19
id.21   -0.9654680   5    1   id  21
id.22   -2.6375909   2    1   id  22
id.24   -0.7818230   4    1   id  24
id.27    5.0796517   2    1   id  27
id.28   -0.1859336   2    1   id  28
id.29    0.1469088   4    3   id  29
id.30   -0.6481129   6    2   id  30
firm.1   1.8944869   1    2 firm   1
firm.2  -6.3525127   1    1 firm   2
firm.3  -1.2368632   1    2 firm   3
firm.4  -0.4006118   1    1 firm   4
firm.7   3.3574025   3    1 firm   7
firm.8   0.3089538   5    1 firm   8
firm.9  -0.7960092   2    3 firm   9
firm.11  0.5649456   3    1 firm  11
firm.12  0.5403380   1    2 firm  12
firm.13  1.0232170   3    1 firm  13
firm.14 -0.6533862   1    3 firm  14
firm.15 -0.2532502   3    1 firm  15
firm.16 -0.2619149   3    1 firm  16
firm.17 -0.0300935   4    1 firm  17
firm.18  2.1036168   3    1 firm  18
firm.19  1.8114130   2    1 firm  19
firm.20  1.6385840   1    1 firm  20
firm.22 -0.4610868   2    2 firm  22
firm.23  2.2870124   1    4 firm  23
firm.24 -1.5476571   1    2 firm  24
firm.25 -0.3697103   1    2 firm  25
firm.26  1.6609255   2    1 firm  26
firm.27  0.4718796   2    3 firm  27
firm.29 -1.1076292   2    1 firm  29
firm.31 -2.6469915   1    1 firm  31
firm.32 -3.2749920   2    1 firm  32
year.1  -1.9948239  21    5 year   1
year.2  -0.5146545  18    5 year   2
year.3   0.7795448  13    5 year   3
Warning messages:
1: In is.estimable(ef, obj$fe) :
  non-estimable function, largest error 0.4 in coordinate 3 ("id.3")
2: In getfe.kaczmarz(obj, se, ef = ef, bN = bN, robust = robust, cluster = cluster) :
  Supplied function seems non-estimable
> # get the names to use below, just to make it easier
> # lower precision in output
> options(digits=5)
> nm <- rownames(alpha)
> getfe(est,ef='zm',se=TRUE)
          effect obs comp      se
id.1     2.70645   2    1 2.94035
id.2     0.00000   5    1 0.00000
id.5    -0.92442   2    1 3.34056
id.6     2.61776   3    1 4.10518
id.7     1.15197   2    1 1.96168
id.10    2.19930   1    1 4.46844
id.11    1.73017   1    1 3.76489
id.12    0.33843   1    1 2.37165
id.15    0.81774   2    1 2.53980
id.16    0.23114   1    1 3.97955
id.17    1.88311   1    1 4.21095
id.19    1.07002   3    1 2.36597
id.21    0.38365   5    1 1.31274
id.22   -1.28847   2    1 1.47881
id.24    0.56730   4    1 1.26353
id.27    6.42877   2    1 3.84005
id.28    1.16319   2    1 3.16566
firm.2  -6.23633   1    1 3.35511
firm.4  -0.28443   1    1 3.24111
firm.7   3.47359   3    1 1.66190
firm.8   0.42514   5    1 2.87876
firm.11  0.68113   3    1 1.30198
firm.13  1.13940   3    1 1.67239
firm.15 -0.13707   3    1 2.88215
firm.16 -0.14573   3    1 1.79310
firm.17  0.08609   4    1 1.43239
firm.18  2.21980   3    1 1.47635
firm.19  1.92760   2    1 1.57583
firm.20  1.75477   1    1 2.55472
firm.26  1.77711   2    1 1.56211
firm.29 -0.99145   2    1 1.61794
firm.31 -2.53081   1    1 2.55654
firm.32 -3.15881   2    1 2.15478
icpt.1  -3.46013  39    1 2.03165
id.14    0.11573   1    2 2.29503
id.30    0.00000   6    2 0.00000
firm.1   2.09124   1    2 1.32839
firm.3  -1.04011   1    2 1.38527
firm.12  0.73709   1    2 1.50605
firm.22 -0.26434   2    2 1.39249
firm.24 -1.35091   1    2 1.30896
firm.25 -0.17296   1    2 1.54496
icpt.2  -2.83969   7    2 1.14289
id.13   -1.27133   1    3 2.26871
id.29    0.00000   4    3 0.00000
firm.9  -0.47017   2    3 1.13676
firm.14 -0.32755   1    3 1.19874
firm.27  0.79772   2    3 1.14816
icpt.3  -2.17375   5    3 0.90792
id.3     0.00000   1    4 0.00000
firm.23  0.00000   1    4 0.00000
icpt.4   2.57920   1    4 1.22529
year.1   0.00000  21    5 0.00000
year.2   1.48017  18    5 1.10416
year.3   2.77437  13    5 1.21265
> getfe(est,ef='zm2',se=TRUE)
           effect obs comp     se
id.1     1.466675   2    1 2.1720
id.2    -1.239771   5    1 1.7389
id.5    -2.164190   2    1 1.8755
id.6     1.377990   3    1 2.4533
id.7    -0.087797   2    1 1.7748
id.10    0.959528   1    1 2.9711
id.11    0.490398   1    1 2.6489
id.12   -0.901339   1    1 2.5070
id.15   -0.422030   2    1 2.6964
id.16   -1.008632   1    1 2.8231
id.17    0.643341   1    1 2.5755
id.19   -0.169755   3    1 1.3969
id.21   -0.856119   5    1 1.2358
id.22   -2.528242   2    1 2.2548
id.24   -0.672474   4    1 1.4876
id.27    5.189001   2    1 2.6034
id.28   -0.076584   2    1 1.4970
firm.2  -6.236329   1    1 3.1132
firm.4  -0.284428   1    1 2.8899
firm.7   3.473586   3    1 1.6524
firm.8   0.425137   5    1 2.4695
firm.11  0.681129   3    1 1.3285
firm.13  1.139401   3    1 1.3255
firm.15 -0.137067   3    1 2.6962
firm.16 -0.145731   3    1 1.6387
firm.17  0.086090   4    1 1.3069
firm.18  2.219800   3    1 1.5147
firm.19  1.927597   2    1 1.7093
firm.20  1.754768   1    1 2.4941
firm.26  1.777109   2    1 1.6044
firm.29 -0.991446   2    1 1.6775
firm.31 -2.530808   1    1 2.8211
firm.32 -3.158808   2    1 1.8781
icpt.1  -2.220357  39    1 0.6706
id.14    0.057867   1    2 1.2071
id.30   -0.057867   6    2 1.2071
firm.1   2.091236   1    2 1.5290
firm.3  -1.040114   1    2 1.4185
firm.12  0.737087   1    2 1.4892
firm.22 -0.264338   2    2 1.3895
firm.24 -1.350908   1    2 1.2117
firm.25 -0.172962   1    2 1.2335
icpt.2  -2.781819   7    2 1.0349
id.13   -0.635667   1    3 1.0576
id.29    0.635667   4    3 1.0576
firm.9  -0.470171   2    3 1.0930
firm.14 -0.327548   1    3 1.0666
firm.27  0.797718   2    3 0.9703
icpt.3  -2.809420   5    3 1.5433
id.3     0.000000   1    4 0.0000
firm.23  0.000000   1    4 0.0000
icpt.4   2.579201   1    4 1.3354
year.1   0.000000  21    5 0.0000
year.2   1.480169  18    5 1.0697
year.3   2.774369  13    5 1.2440
> ef <- function(v,addnames) {
+   names(v) <- nm
+   w <- c(v['id.2']-v['id.1'],exp(v['id.2']-v['id.1']),
+          v['id.2']+v['firm.2']+v['year.1'],v['id.5']+v['firm.4']+v['year.2'])
+   if(addnames) names(w) <-c('id2-id1','exp(id2-id1)','id2+f2+y1','id5+f4+y2')
+   w
+ }
> getfe(est,ef=ef,se=TRUE)
                effect        se
id2-id1      -2.706446 2.7141083
exp(id2-id1)  0.066774 0.0076218
id2+f2+y1    -9.696457 4.3076086
id5+f4+y2    -3.188806 3.4458424
> 
> # test whether we have estimable functions
> 
> R <- est$r.residuals - est$residuals
> 
> cat('myef :',is.estimable(ef,est$fe,R),'\n')
myef : TRUE 
> for(n in c('ref','zm','zm2','ln')) {
+   cat(n,':',is.estimable(efactory(est,n),est$fe,R),'\n')
+ }
ref : TRUE 
zm : TRUE 
zm2 : TRUE 
ln : FALSE 
Warning message:
In is.estimable(efactory(est, n), est$fe, R) :
  non-estimable function, largest error 0.2 in coordinate 3 ("id.3")
> 
> proc.time()
   user  system elapsed 
  6.852   0.232   7.088 
