
R version 2.15.2 (2012-10-26) -- "Trick or Treat"
Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
Loading required package: lattice
Loading required package: Rcgmin
Loading required package: numDeriv
> options(lfe.threads=1)
> set.seed(655320)
> x <- rnorm(50000,mean=200)
> x2 <- rnorm(length(x))
> x3 <- rexp(length(x))
> ## create individual and firm
> id <- factor(sample(15000,length(x),replace=TRUE))
> firm <- factor(sample(13000,length(x),replace=TRUE))
> shoe <- factor(sample(1000,length(x),replace=TRUE))
> shirt <- factor(sample(1000,length(x),replace=TRUE))
> ## effects
> id.eff <- rnorm(nlevels(id))
> firm.eff <- rnorm(nlevels(firm))
> shoe.eff <- rnorm(nlevels(shoe))
> shirt.eff <- rnorm(nlevels(shirt))
> ## left hand side
> y <- x + 0.25*x2 + 0.5*x3 + id.eff[id] + firm.eff[firm] + shoe.eff[shoe] + shirt.eff[shirt] + rnorm(length(x))
> 
> ## estimate
> system.time(est <- felm(y ~ x+x2 + x3 + G(id) + G(firm) + G(shoe) + G(shirt)))
   user  system elapsed 
  2.240   0.012   2.178 
> summary(est)

Call:
   felm(formula = y ~ x + x2 + x3 + G(id) + G(firm) + G(shoe) +      G(shirt)) 

Residuals:
       Min         1Q     Median         3Q        Max 
-3.043e+00 -4.090e-01  1.695e-09  4.134e-01  2.889e+00 

Coefficients:
   Estimate Std. Error t value Pr(>|t|)    
x  0.993257   0.006980  142.31   <2e-16 ***
x2 0.262606   0.006955   37.76   <2e-16 ***
x3 0.500926   0.006965   71.92   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 1.009 on 20869 degrees of freedom
Multiple R-squared: 0.933   Adjusted R-squared: 0.8395 
F-statistic: 9.976 on 29130 and 20869 DF, p-value: < 2.2e-16 
*** Standard errors may be slightly too high due to more than 2 groups


> cat('Components:',nlevels(est$cfactor),'largest:',sum(est$cfactor == '1'),'\n')
Components: 47 largest: 49954 
> ## extract the group fixed effects
>   ## verify that id and firm coefficients are 1
> options(scipen=8)
> 
> system.time(
+ for(ef in c('ln','ref','zm','zm2')) {
+   fe <- getfe(est,ef=ef)
+   ## merge back
+ 
+   ideff <- fe[paste('id',id,sep='.'),'effect']
+   firmeff <- fe[paste('firm',firm,sep='.'),'effect']
+   shoeeff <- fe[paste('shoe',shoe,sep='.'),'effect']
+   shirteff <- fe[paste('shirt',shirt,sep='.'),'effect']
+   if(ef %in% c('zm','zm2')) {
+     icpt <- fe[paste('icpt',1:nlevels(est$cfactor),sep='.'),'effect'][est$cfactor]
+     lmres <- lm(y ~ x + x2 + x3 + ideff + firmeff + shoeeff +shirteff + icpt-1)
+     acc <- coef(lmres)[c('ideff','firmeff','shoeeff','shirteff','icpt')]-1
+   } else {
+     lmres <- lm(y ~ x + x2 + x3 + ideff + firmeff + shoeeff +shirteff-1)
+     acc <- coef(lmres)[c('ideff','firmeff','shoeeff','shirteff')]-1
+   }
+   print(summary(lmres,digits=8))	
+   cat('accuracy:',sprintf('%.2e',acc),'\n')
+ }
+ )

Call:
lm(formula = y ~ x + x2 + x3 + ideff + firmeff + shoeeff + shirteff - 
    1)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0429 -0.4090  0.0000  0.4134  2.8891 

Coefficients:
           Estimate Std. Error  t value Pr(>|t|)    
x        0.99325724 0.00002422 41008.99   <2e-16 ***
x2       0.26260555 0.00291327    90.14   <2e-16 ***
x3       0.50092580 0.00289318   173.14   <2e-16 ***
ideff    1.00000000 0.00243259   411.08   <2e-16 ***
firmeff  1.00000000 0.00242073   413.10   <2e-16 ***
shoeeff  1.00000000 0.00278339   359.27   <2e-16 ***
shirteff 1.00000000 0.00284596   351.38   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.6522 on 49993 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:     1 
F-statistic: 6.752e+08 on 7 and 49993 DF,  p-value: < 2.2e-16 

accuracy: 9.45e-10 8.82e-11 1.37e-11 3.39e-11 

Call:
lm(formula = y ~ x + x2 + x3 + ideff + firmeff + shoeeff + shirteff - 
    1)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0429 -0.4090  0.0000  0.4134  2.8891 

Coefficients:
           Estimate Std. Error  t value Pr(>|t|)    
x        0.99325724 0.00002405 41291.74   <2e-16 ***
x2       0.26260555 0.00291327    90.14   <2e-16 ***
x3       0.50092580 0.00289318   173.14   <2e-16 ***
ideff    1.00000000 0.00243338   410.95   <2e-16 ***
firmeff  1.00000000 0.00241897   413.40   <2e-16 ***
shoeeff  1.00000000 0.00278340   359.27   <2e-16 ***
shirteff 1.00000000 0.00284596   351.38   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.6522 on 49993 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:     1 
F-statistic: 6.752e+08 on 7 and 49993 DF,  p-value: < 2.2e-16 

accuracy: 9.36e-10 9.03e-11 1.27e-11 9.27e-12 

Call:
lm(formula = y ~ x + x2 + x3 + ideff + firmeff + shoeeff + shirteff + 
    icpt - 1)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0429 -0.4090  0.0000  0.4134  2.8891 

Coefficients:
           Estimate Std. Error  t value Pr(>|t|)    
x        0.99325724 0.00003448 28804.01   <2e-16 ***
x2       0.26260555 0.00291331    90.14   <2e-16 ***
x3       0.50092580 0.00289321   173.14   <2e-16 ***
ideff    1.00000000 0.00243345   410.94   <2e-16 ***
firmeff  1.00000000 0.00242158   412.95   <2e-16 ***
shoeeff  1.00000000 0.00278343   359.27   <2e-16 ***
shirteff 1.00000000 0.00284599   351.37   <2e-16 ***
icpt     1.00000000 0.05229465    19.12   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.6522 on 49992 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:     1 
F-statistic: 5.908e+08 on 8 and 49992 DF,  p-value: < 2.2e-16 

accuracy: 9.49e-10 9.36e-11 -1.71e-11 4.81e-11 1.38e-09 

Call:
lm(formula = y ~ x + x2 + x3 + ideff + firmeff + shoeeff + shirteff + 
    icpt - 1)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0429 -0.4090  0.0000  0.4134  2.8891 

Coefficients:
           Estimate Std. Error  t value Pr(>|t|)    
x        0.99325724 0.00004358 22792.28   <2e-16 ***
x2       0.26260555 0.00291331    90.14   <2e-16 ***
x3       0.50092580 0.00289321   173.14   <2e-16 ***
ideff    1.00000000 0.00243344   410.94   <2e-16 ***
firmeff  1.00000000 0.00242158   412.95   <2e-16 ***
shoeeff  1.00000000 0.00278343   359.27   <2e-16 ***
shirteff 1.00000000 0.00284599   351.37   <2e-16 ***
icpt     1.00000000 0.05232523    19.11   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.6522 on 49992 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:     1 
F-statistic: 5.908e+08 on 8 and 49992 DF,  p-value: < 2.2e-16 

accuracy: 9.33e-10 9.14e-11 2.35e-11 -2.36e-12 1.30e-09 
   user  system elapsed 
 14.693   0.060  14.767 
Warning messages:
1: In is.estimable(ef, obj$fe, R) :
  non-estimable function, largest error 0.6 in coordinate 18570 ("firm.4208")
2: In getfe.kaczmarz(obj, se, ef = ef, bN = bN) :
  Supplied function seems non-estimable

> 
> proc.time()
   user  system elapsed 
 21.213   0.160  21.332 
