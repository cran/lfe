
R Under development (unstable) (2014-10-08 r66730) -- "Unsuffered Consequences"
Copyright (C) 2014 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
> options(lfe.threads=2,digits=5,warn=1)
> set.seed(42)
> x <- rnorm(1000)
> x2 <- rnorm(length(x))
> 
> id <- factor(sample(10,length(x),replace=TRUE))
> firm <- factor(sample(3,length(x),replace=TRUE,prob=c(2,1,1)))
> id.eff <- rnorm(nlevels(id))
> firm.eff <- rnorm(nlevels(firm))
> 
> ## left hand side
> u <- rnorm(length(x))
> x3 <- rnorm(length(x))
> x4 <- rnorm(length(x))
> Q <- 0.3*x3 + x + 0.2*x2 + id.eff[id] + 0.15*u + rnorm(length(x),sd=0.2)
> R <- 0.001*x3 + 0.2*x + 0.5*x2 + 0.7*id.eff[id] - 0.11*u + rnorm(length(x),sd=0.2)
> y <- x + 0.5*x2 + id.eff[id] + firm.eff[firm] + Q + R + u
> 
> ## estimate and print result
> est <- felm(y ~ x+x2 | id+firm |(Q|R~x3+x4))
> summary(est,robust=TRUE)

Call:
   felm(formula = y ~ x + x2 | id + firm | (Q | R ~ x3 + x4)) 

Residuals:
   Min     1Q Median     3Q    Max 
-3.391 -0.720  0.021  0.692  3.767 

Coefficients:
         Estimate Robust s.e t value Pr(>|t|)    
x           1.124      0.826    1.36     0.17    
x2          1.161      2.177    0.53     0.59    
`Q(fit)`    1.114      0.118    9.44   <2e-16 ***
`R(fit)`   -0.413      4.341   -0.10     0.92    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.871 on 984 degrees of freedom
Multiple R-squared: 0.947   Adjusted R-squared: 0.946 
F-statistic(normal s.e.):1.14e+03 on 15 and 984 DF, p-value: <2e-16 
F-statistic(proj):  535 on 15 and 984 DF, p-value: <2e-16 
*** F-test for robust/clustered standard errors is unreliable


> clu <- factor(sample(10,length(x), replace=TRUE))
> est <- felm(y ~ x+x2 | id + firm |(Q|R ~ x3+x4), cluster=clu)
> summary(est, robust=TRUE)

Call:
   felm(formula = y ~ x + x2 | id + firm | (Q | R ~ x3 + x4), clustervar = clu) 

Residuals:
   Min     1Q Median     3Q    Max 
-3.391 -0.720  0.021  0.692  3.767 

Coefficients:
         Estimate Cluster s.e. t value Pr(>|t|)    
x           1.124        0.509    2.21    0.027 *  
x2          1.161        1.267    0.92    0.360    
`Q(fit)`    1.114        0.113    9.85   <2e-16 ***
`R(fit)`   -0.413        2.537   -0.16    0.871    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.871 on 984 degrees of freedom
Multiple R-squared: 0.947   Adjusted R-squared: 0.946 
F-statistic(normal s.e.):1.14e+03 on 15 and 984 DF, p-value: <2e-16 
F-statistic(proj): 1.25e+03 on 15 and 984 DF, p-value: <2e-16 
*** F-test for robust/clustered standard errors is unreliable


> for(s1 in est$step1) print(summary(s1))

Call:
   felm(formula = Q ~ x + x2 + (x3 + x4) | id + firm + 0, clustervar = clu) 

Residuals:
     Min       1Q   Median       3Q      Max 
-0.71561 -0.15694 -0.00713  0.17762  0.81378 

Coefficients:
   Estimate Cluster s.e. t value Pr(>|t|)    
x   0.99135      0.00857  115.61   <2e-16 ***
x2  0.20646      0.00440   46.98   <2e-16 ***
x3  0.29904      0.00668   44.78   <2e-16 ***
x4 -0.00224      0.00835   -0.27     0.79    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.246 on 984 degrees of freedom
Multiple R-squared: 0.971   Adjusted R-squared: 0.971 
F-statistic(normal s.e.):2.2e+03 on 15 and 984 DF, p-value: <2e-16 
F-statistic(proj): 3.25e+03 on 15 and 984 DF, p-value: <2e-16 
F-stat (excl i.v. n.s.e): 760 on 2 and 984 DF, p-value: <2e-16 
F-stat (excl i.v. proj): 4.82e+03 on 2 and 984 DF, p-value: <2e-16 
*** F-test for excluded instruments assumes constant absorbed effects
*** F-test for robust/clustered standard errors is unreliable



Call:
   felm(formula = R ~ x + x2 + (x3 + x4) | id + firm + 0, clustervar = clu) 

Residuals:
      Min        1Q    Median        3Q       Max 
-0.714478 -0.153933 -0.000204  0.152712  0.805161 

Coefficients:
   Estimate Cluster s.e. t value Pr(>|t|)    
x   0.20430      0.00726   28.12   <2e-16 ***
x2  0.50491      0.00724   69.75   <2e-16 ***
x3  0.00449      0.00501    0.90     0.37    
x4  0.00581      0.00682    0.85     0.39    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.227 on 984 degrees of freedom
Multiple R-squared: 0.933   Adjusted R-squared: 0.932 
F-statistic(normal s.e.): 912 on 15 and 984 DF, p-value: <2e-16 
F-statistic(proj):  472 on 15 and 984 DF, p-value: <2e-16 
F-stat (excl i.v. n.s.e):0.582 on 2 and 984 DF, p-value: 0.559 
F-stat (excl i.v. proj): 1.69 on 2 and 984 DF, p-value: 0.186 
*** F-test for excluded instruments assumes constant absorbed effects
*** F-test for robust/clustered standard errors is unreliable


> 
> proc.time()
   user  system elapsed 
  8.925   0.104   8.353 
