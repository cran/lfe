
R Under development (unstable) (2013-11-30 r64358) -- "Unsuffered Consequences"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
> options(lfe.threads=2)
> set.seed(6553)
> # single fixed effect, special case which we risk destroying when we optimize, so check it
> x <- rnorm(20000,mean=2)
> x2 <- rnorm(length(x))
> x3 <- rexp(length(x))
> ## create individual and firm
> id <- factor(sample(15000,length(x),replace=TRUE))
> nlevels(id)
[1] 11014
> ## effects
> id.eff <- rnorm(nlevels(id))
> 
> ## left hand side
> y <- x + 0.25*x2 + 0.5*x3 + id.eff[id] + rnorm(length(x))
> 
> ## estimate
> summary(est <- felm(y ~ x+x2 + x3 + G(id)))

Call:
   felm(formula = y ~ x + x2 + x3 + G(id)) 

Residuals:
    Min      1Q  Median      3Q     Max 
-3.2166 -0.3171  0.0000  0.3195  3.1914 

Coefficients:
   Estimate Std. Error t value Pr(>|t|)    
x   1.02548    0.01054   97.25   <2e-16 ***
x2  0.24540    0.01069   22.95   <2e-16 ***
x3  0.49951    0.01078   46.35   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.005 on 8983 degrees of freedom
Multiple R-squared: 0.8631   Adjusted R-squared: 0.6953 
F-statistic: 5.143 on 11016 and 8983 DF, p-value: < 2.2e-16 


> 
> ## extract the group fixed effects
> fe <- getfe(est, se=TRUE)
> ## merge back
> head(fe)
          effect obs comp fe idx        se
id.1  0.21404699   1    1 id   1 1.1451466
id.4 -0.06212255   1    1 id   4 1.1510789
id.5 -3.54578183   1    1 id   5 1.0725434
id.6  0.54367221   1    1 id   6 1.1035245
id.7  1.08356653   2    1 id   7 0.7760234
id.8 -0.68103419   2    1 id   8 0.7761612
> ideff <- fe[paste('id',id,sep='.'),'effect']
> 
> ## verify that id and firm coefficients are 1
> options(scipen=8)
> summary(lm(y ~ x + x2 + x3 + ideff -1),digits=8)

Call:
lm(formula = y ~ x + x2 + x3 + ideff - 1)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.2166 -0.3171  0.0000  0.3195  3.1914 

Coefficients:
      Estimate Std. Error t value Pr(>|t|)    
x     1.025484   0.002741  374.11   <2e-16 ***
x2    0.245398   0.004817   50.94   <2e-16 ***
x3    0.499506   0.004405  113.40   <2e-16 ***
ideff 1.000000   0.003795  263.49   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6733 on 19996 degrees of freedom
Multiple R-squared:  0.9521,	Adjusted R-squared:  0.9521 
F-statistic: 9.946e+04 on 4 and 19996 DF,  p-value: < 2.2e-16

> 
> # no factor
> summary(felm(y ~ x + x2 + x3))

Call:
   felm(formula = y ~ x + x2 + x3) 

Residuals:
     Min       1Q   Median       3Q      Max 
-5.33782 -0.96075  0.01612  0.94496  5.98816 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.001693   0.024760  -0.068    0.945    
x            0.995758   0.010030  99.281   <2e-16 ***
x2           0.246110   0.010187  24.159   <2e-16 ***
x3           0.484767   0.010225  47.410   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.424 on 19996 degrees of freedom
Multiple R-squared: 0.388   Adjusted R-squared: 0.3878 
F-statistic:  4225 on 3 and 19996 DF, p-value: < 2.2e-16 


> summary(lm(y ~ x + x2 + x3))

Call:
lm(formula = y ~ x + x2 + x3)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.3378 -0.9607  0.0161  0.9450  5.9882 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) -0.001693   0.024760  -0.068    0.945    
x            0.995758   0.010030  99.281   <2e-16 ***
x2           0.246110   0.010187  24.159   <2e-16 ***
x3           0.484767   0.010225  47.410   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.424 on 19996 degrees of freedom
Multiple R-squared:  0.388,	Adjusted R-squared:  0.3879 
F-statistic:  4225 on 3 and 19996 DF,  p-value: < 2.2e-16

> 
> # no covariate
> summary(est <- felm(y ~ G(id)))

Call:
   felm(formula = y ~ G(id)) 

Residuals:
    Min      1Q  Median      3Q     Max 
-4.4301 -0.4960  0.0000  0.4916  5.0681 

Coefficients:
(No coefficients)


> head(getfe(est, se=TRUE))
       effect obs comp fe idx        se
id.1 3.839052   1    1 id   1 1.5343104
id.4 4.571562   1    1 id   4 1.7227333
id.5 1.759744   1    1 id   5 1.5130950
id.6 3.899976   1    1 id   6 1.6809861
id.7 3.526316   2    1 id   7 0.9965326
id.8 2.001778   2    1 id   8 1.0486008
> 
> 
> proc.time()
   user  system elapsed 
 13.128   0.328  13.263 
