
R version 2.12.2 (2011-02-25)
Copyright (C) 2011 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(lfe)
Loading required package: Matrix
Loading required package: lattice

Attaching package: 'Matrix'

The following object(s) are masked from 'package:base':

    det

> options(lfe.threads=2)
> set.seed(655320)
> x <- rnorm(20000,mean=2000)
> x2 <- rnorm(length(x))
> x3 <- rexp(length(x))
> ## create individual and firm
> id <- factor(sample(15000,length(x),replace=TRUE))
> firm <- factor(sample(13000,length(x),replace=TRUE))
> 
> ## effects
> id.eff <- rnorm(nlevels(id))
> firm.eff <- rnorm(nlevels(firm))
> 
> ## left hand side
> y <- x + 0.25*x2 + 0.5*x3 + id.eff[id] + firm.eff[firm] + rnorm(length(x))
> 
> ## estimate
> summary(est <- felm(y ~ x+x2 + x3 + G(id) + G(firm)))

Call:
   felm(formula = y ~ x + x2 + x3 + G(id) + G(firm)) 

Residuals:
       Min         1Q     Median         3Q        Max 
-1.533e+00 -1.267e-09  0.000e+00  2.072e-09  1.409e+00 

Coefficients:
   Estimate Std. Error t value Pr(>|t|)    
x   1.04336    0.03738  27.911  < 2e-16 ***
x2  0.30186    0.03827   7.887 1.21e-14 ***
x3  0.42771    0.03692  11.585  < 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 1.006 on 693 degrees of freedom
Multiple R-squared:     1   Adjusted R-squared:     1 
F-statistic: 4.1e+06 on 19307 and 693 DF, p-value: < 2.2e-16 


> cat('Components:',nlevels(est$cfactor),'largest:',sum(est$cfactor == '1'),'\n')
Components: 1972 largest: 15846 
> ## extract the group fixed effects
> fe <- getfe(est)
> ## merge back
> 
> ideff <- fe[paste('id',id,sep='.'),'effect']
> firmeff <- fe[paste('firm',firm,sep='.'),'effect']
> 
> ## verify that id and firm coefficients are 1
> options(scipen=8)
> summary(lm(y ~ x + x2 + x3 + ideff + firmeff-1),digits=8)

Call:
lm(formula = y ~ x + x2 + x3 + ideff + firmeff - 1)

Residuals:
   Min     1Q Median     3Q    Max 
-1.533  0.000  0.000  0.000  1.409 

Coefficients:
          Estimate Std. Error t value Pr(>|t|)    
x       1.04335742 0.00003305 31573.5   <2e-16 ***
x2      0.30185740 0.00132787   227.3   <2e-16 ***
x3      0.42770781 0.00131966   324.1   <2e-16 ***
ideff   1.00000000 0.00076300  1310.6   <2e-16 ***
firmeff 1.00000000 0.00076211  1312.2   <2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Residual standard error: 0.1872 on 19995 degrees of freedom
Multiple R-squared:     1,	Adjusted R-squared:     1 
F-statistic: 4.568e+11 on 5 and 19995 DF,  p-value: < 2.2e-16 

> 
